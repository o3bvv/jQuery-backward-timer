/**
 * @summary     jQuery.backward_timer
 * @description This plugin gives an ability to create controlled backward timers on web pages.
 * @version     1.1.4
 * @file        jquery-backward-timer.min.js
 * @author      oblalex
 * @contact     http://about.me/oblovatniy
 * @copyright   Copyright 2014-2015 Alexander Oblovatniy
 *
 * This source file is free software, available under the following license:
 *   MIT license - https://github.com/oblalex/jQuery-backward-timer/blob/gh-pages/LICENSE
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 */
!function(t){t.backward_timer=function(e){var s={seconds:5,step:1,stop_at_zero:!0,format:"h%:m%:s%",value_setter:void 0,on_start:function(t){},on_cancel:function(t){},on_exhausted:function(t){},on_tick:function(t){}},o=this;o.seconds_left=0,o.final_hour=Math.floor(Date.now())+5,o.target=t(e),o.timeout=void 0,o.settings={},o.methods={init:function(e){o.settings=t.extend({},s,e),null==o.settings.value_setter&&(o.target.is("input")?o.settings.value_setter="val":o.settings.value_setter="text"),o.methods.reset()},start:function(){if(null==o.timeout&&!o.methods._is_exhausted()){o.settings.on_start(o);var t=o.seconds_left==o.settings.seconds?0:1e3*o.settings.step;setTimeout(o.methods._on_tick,t,t)}},cancel:function(){null!=o.timeout&&(clearTimeout(o.timeout),o.timeout=void 0,o.settings.on_cancel(o))},reset:function(){o.final_hour=parseInt(o.settings.seconds)+Math.floor(Date.now()),o.seconds_left=o.settings.seconds,o.methods._render_seconds()},_on_tick:function(t){if(0!=t&&o.settings.on_tick(o),o.methods._render_seconds(),o.methods._is_exhausted())o.timeout=void 0,o.settings.on_exhausted(o);else{if(o.seconds_left<o.settings.step&&o.settings.stop_at_zero)var e=o.seconds_left;else e=o.settings.step;o.seconds_left=o.final_hour-Math.floor(Date.now());var s=1e3*e;o.timeout=setTimeout(o.methods._on_tick,s,s)}},_render_seconds:function(){var t=o.methods._seconds_to_dhms(o.seconds_left),e=o.settings.format;e=(e=-1!==e.indexOf("d%")?e.replace("d%",t.d).replace("h%",o.methods._check_leading_zero(t.h)):e.replace("h%",24*t.d+t.h)).replace("m%",o.methods._check_leading_zero(t.m)).replace("s%",o.methods._check_leading_zero(t.s)),o.seconds_left<0&&(e="-"+e),o.target[o.settings.value_setter](e)},_seconds_to_dhms:function(t){t=Math.abs(t);var e=Math.floor(t/86400),s=(t=t-24*e*3600,Math.floor(t/3600)),o=(t=t-3600*s,Math.floor(t/60));return{d:e,h:s,m:o,s:t=Math.floor(t-60*o)}},_check_leading_zero:function(t){return t<10?"0"+t:""+t},_is_exhausted:function(){return o.seconds_left<=0&&o.settings.stop_at_zero}}},t.fn.backward_timer=function(e){var s=arguments;return this.each(function(){var o=t(this).data("backward_timer");return null==o&&(o=new t.backward_timer(this),t(this).data("backward_timer",o)),o.methods[e]?o.methods[e].apply(this,Array.prototype.slice.call(s,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.backward_timer"):o.methods.init.apply(this,s)})}}(jQuery);
